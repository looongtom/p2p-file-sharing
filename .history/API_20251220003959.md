# P2P File Sharing API Documentation

The peer nodes now expose a Flask REST API instead of an interactive command-line interface.

## Base URL

Each peer exposes its API on port 5000 inside the container. The ports are mapped as follows:
- **peer1**: `http://localhost:5001`
- **peer2**: `http://localhost:5002`
- **peer3**: `http://localhost:5003`

## Endpoints

### 1. Share a File (Seed)

**POST** `/api/torrent/send`

Share a file from the node's seed directory.

**Request Body:**
```json
{
  "filename": "Xshell5.rar"
}
```

**Response:**
```json
{
  "ok": true,
  "message": "File Xshell5.rar is now being shared"
}
```

**Example:**
```bash
curl -X POST http://localhost:5001/api/torrent/send \
  -H "Content-Type: application/json" \
  -d '{"filename": "Xshell5.rar"}'
```

---

### 2. List Files on Tracker

**GET** `/api/torrent/list`

Get a list of all files available on the tracker.

**Response:**
```json
{
  "ok": true,
  "items": [
    {
      "filename": "Xshell5.rar",
      "size": 12345678,
      "peers": 2,
      "infohash": "a1b2c3d4e5.."
    }
  ],
  "count": 1
}
```

**Example:**
```bash
curl http://localhost:5001/api/torrent/list
```

---

### 3. Download a File

**POST** `/api/torrent/download`

Download a file by filename or infohash. The download runs asynchronously in the background.

**Request Body (by filename):**
```json
{
  "filename": "Xshell5.rar"
}
```

**Request Body (by infohash):**
```json
{
  "infohash": "a1b2c3d4e5f6..."
}
```

**Response:**
```json
{
  "ok": true,
  "message": "Download started for filename Xshell5.rar"
}
```

**Example:**
```bash
curl -X POST http://localhost:5001/api/torrent/download \
  -H "Content-Type: application/json" \
  -d '{"filename": "Xshell5.rar"}'
```

---

### 4. Get Node Status

**GET** `/api/status`

Get the current status of the node, including active downloads and seeding information.

**Response:**
```json
{
  "ok": true,
  "node_id": 1,
  "seeding_count": 1,
  "active_downloads": [
    {
      "infohash": "a1b2c3d4e5..",
      "filename": "Xshell5.rar",
      "progress": "10/50",
      "size": 12345678
    }
  ],
  "downloads_count": 1
}
```

**Example:**
```bash
curl http://localhost:5001/api/status
```

---

### 5. Exit Gracefully

**POST** `/api/exit`

Notify the tracker about all active downloads before exiting. This sends exit signals for all downloads.

**Response:**
```json
{
  "ok": true,
  "message": "Exit signal sent to tracker"
}
```

**Example:**
```bash
curl -X POST http://localhost:5001/api/exit
```

---

### 6. Health Check

**GET** `/health`

Simple health check endpoint.

**Response:**
```json
{
  "ok": true,
  "status": "healthy"
}
```

**Example:**
```bash
curl http://localhost:5001/health
```

---

## Error Responses

All endpoints return standard HTTP status codes:
- `200` - Success
- `400` - Bad Request (missing or invalid parameters)
- `404` - Not Found (file not found)
- `500` - Internal Server Error

Error response format:
```json
{
  "ok": false,
  "error": "Error message here"
}
```

